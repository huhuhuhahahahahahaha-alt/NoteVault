<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Notebook — Private Notes</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Cardo:400,700&display=swap" rel="stylesheet">
<style>
  /* Nostalgic paper / vintage notebook theme */
  :root{
    --paper:#fbf7ef;
    --ink:#1b1b12;
    --accent:#7b3d2d;
    --muted:#6b6156;
    --seal:#8b0000;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#efe8dc, #f7efe6);font-family:Cardo, serif;color:var(--ink)}
  body::after{
    content:"";position:fixed;inset:0;pointer-events:none;background-image:
    radial-gradient(rgba(0,0,0,0.02) 1px, transparent 1px);
    background-size:7px 7px;opacity:0.35;
  }
  .wrap{max-width:980px;margin:34px auto;padding:26px;background:linear-gradient(180deg, #fff8ee, #fff6ec);box-shadow:0 10px 40px rgba(20,20,10,0.06);border-radius:10px;border:1px solid rgba(0,0,0,0.04)}
  header{display:flex;gap:14px;align-items:center}
  .logo{width:68px;height:68px;border-radius:8px;background:linear-gradient(135deg,#f1d6c9,#e6c6b5);display:flex;align-items:center;justify-content:center;font-family:Special Elite, monospace;font-weight:700;color:var(--accent);font-size:18px;cursor:pointer;user-select:none;box-shadow:inset 0 -6px 18px rgba(0,0,0,0.03)}
  h1{margin:0;font-size:28px;letter-spacing:0.6px}
  .subtitle{color:var(--muted);font-size:14px;margin-top:2px}
  .layout{display:grid;grid-template-columns:260px 1fr;gap:18px;margin-top:18px}
  .panel{background:transparent}
  .notebook{height:66vh;border-radius:6px;border:1px dashed rgba(0,0,0,0.06);background:
    linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,240,0.8));
    padding:14px;box-shadow:inset 0 1px 0 rgba(0,0,0,0.02)}
  .note-list{overflow:auto;height:calc(66vh - 48px);padding-right:6px}
  .note-item{padding:10px;border-radius:6px;margin-bottom:8px;background:rgba(250,245,235,0.9);cursor:pointer;border-left:3px solid rgba(0,0,0,0.04)}
  .note-item.active{background:linear-gradient(90deg,#fffdf7,#fffbf3);border-left-color:var(--accent)}
  .controls{display:flex;gap:8px;margin-top:10px;align-items:center}
  .btn{padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:#fff;cursor:pointer;font-family:inherit}
  .btn.primary{background:var(--accent);color:#fff;border:none}
  .title{width:100%;padding:10px;border:none;border-bottom:1px dashed rgba(0,0,0,0.06);background:transparent;font-size:18px;font-family:Special Elite, monospace}
  textarea{width:100%;height:calc(66vh - 140px);padding:12px;border:none;background:transparent;resize:none;font-size:16px;line-height:1.5;outline:none;font-family:Cardo,serif}
  .meta{display:flex;justify-content:space-between;align-items:center;margin-top:8px;color:var(--muted);font-size:13px}
  .small{font-size:13px;color:var(--muted)}
  .trial-banner{margin-top:12px;padding:10px;border-radius:8px;background:linear-gradient(90deg,#fff7f2,#fffaf8);border:1px solid rgba(139,69,19,0.06);color:var(--accent)}
  /* vintage buttons for subscribe prompt */
  .pay-prompt{position:fixed;left:50%;top:16px;transform:translateX(-50%);z-index:2000;background:#fff7f3;padding:12px;border-radius:10px;box-shadow:0 12px 40px rgba(0,0,0,0.18);border:1px solid rgba(0,0,0,0.06);display:none}
  .pay-prompt.show{display:flex;gap:12px;align-items:center}
  .pay-cta{background:var(--seal);color:white;padding:8px 10px;border-radius:8px;border:none;cursor:pointer}
  .pay-later{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px 10px;border-radius:8px;cursor:pointer}
  /* paywall overlay */
  .paywall{position:fixed;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.85), rgba(0,0,0,0.95));display:grid;place-items:center;color:white;z-index:3000;padding:20px;opacity:0;pointer-events:none;transition:opacity .25s}
  .paywall.show{opacity:1;pointer-events:auto}
  .pay-box{max-width:760px;background:linear-gradient(180deg,#1f0f0f,#2b0f0f);padding:24px;border-radius:12px;border:2px solid rgba(255,255,255,0.03);text-align:center}
  .pay-box h2{margin-top:0;color:#fff;font-family:Special Elite, monospace}
  .pay-box p{color:#f8d6d6}
  .pay-actions{display:flex;gap:8px;justify-content:center;margin-top:14px}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);padding:8px 10px;border-radius:8px;color:#fff;cursor:pointer}
  .subscribe{background:#a52a2a;border:none;padding:8px 12px;border-radius:8px;color:#fff;cursor:pointer}
  /* cinematic / destruction overlay (nostalgic ash) */
  .cin-overlay{position:fixed;inset:0;display:grid;place-items:center;background:linear-gradient(180deg,rgba(15,10,7,0.6),rgba(6,3,3,0.95));z-index:4000;opacity:0;pointer-events:none;transition:opacity .25s}
  .cin-overlay.show{opacity:1;pointer-events:auto}
  .cin-box{width:880px;max-width:94%;padding:22px;border-radius:12px;background:linear-gradient(180deg,#2b1d18,#1a0f0c);color:#f9efe6;border:1px solid rgba(255,255,255,0.03);box-shadow:0 30px 80px rgba(0,0,0,0.6);text-align:center;font-family:Special Elite, monospace}
  .cin-count{font-size:82px;font-weight:900;margin:6px 0;letter-spacing:3px}
  .cin-term{background:#0b0606;padding:12px;border-radius:8px;margin-top:10px;height:160px;overflow:auto;color:#f1d7d7;font-family:monospace;font-size:14px}
  .cin-actions{margin-top:12px;display:flex;gap:10px;justify-content:center}
  .ctl{padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;cursor:pointer}
  .ctl.warn{background:#8b0000;color:white;border:none}
  /* final destroyed screen */
  .destroyed{position:fixed;inset:0;background:#0b0505;color:#f6e8e8;display:grid;place-items:center;z-index:4100;opacity:0;pointer-events:none;transition:opacity .4s}
  .destroyed.show{opacity:1;pointer-events:auto}
  .destroyed h1{font-family:Special Elite, monospace;font-size:36px;margin:0}
  /* small footer note */
  footer{margin-top:16px;text-align:center;color:var(--muted);font-size:13px}
  /* small responsive */
  @media (max-width:900px){
    .layout{grid-template-columns:1fr}
    .cin-box{padding:14px}
    .cin-term{height:120px}
    .cin-count{font-size:48px}
  }
</style>
</head>
<body>
  <!--
    NOTE: Hidden ARG fragments live in comments below and in console logs.
    The Archivist wrote: "Qui subscript, subscriptus est."
  -->
  <div class="wrap">
    <header>
      <div class="logo" id="logo">NOTE</div>
      <div>
        <h1>Notebook</h1>
        <div class="subtitle">A nostalgic place for your thoughts</div>
      </div>
    </header>

    <div class="layout">
      <div class="panel">
        <div class="notebook">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong style="font-family:Special Elite">My Notes</strong>
            <span class="small" id="trialMeta"></span>
          </div>
          <div class="note-list" id="list"></div>
          <div class="controls">
            <button class="btn" id="newNote">New</button>
            <button class="btn" id="deleteNote">Delete</button>
            <button class="btn" id="exportNote">Export</button>
            <div style="flex:1"></div>
            <div class="small">vintage build</div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="notebook" style="display:flex;flex-direction:column;height:100%">
          <input id="title" class="title" placeholder="Untitled note" />
          <textarea id="body" placeholder="Write something..."></textarea>
          <div class="meta">
            <div>
              <button class="btn primary" id="save">Save</button>
              <button class="btn" id="rename">Rename</button>
              <button class="btn" id="clear">Clear</button>
            </div>
            <div class="small" id="noteMeta">No note selected</div>
          </div>

          <div class="trial-banner" id="trialBanner">
            <strong>Free Trial:</strong> NoteVault Basic — try Pro features for a limited time. <span id="trialTimer" class="small"></span>
          </div>
        </div>
      </div>
    </div>

    <footer>Tip: press <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>P</kbd> for a small surprise.</footer>
  </div>

  <!-- pay prompt (top) -->
  <div class="pay-prompt" id="payPrompt" role="dialog" aria-live="assertive">
    <div>
      <strong style="font-family:Special Elite">Trial expired</strong>
      <div class="small" style="margin-top:4px;color:var(--muted)">Upgrade to NoteVault Pro to keep your words.</div>
    </div>
    <div style="margin-left:8px;display:flex;gap:8px">
      <button class="pay-cta" id="subscribeBtn">SUBSCRIBE</button>
      <button class="pay-later" id="laterBtn">Later</button>
    </div>
  </div>

  <!-- paywall overlay -->
  <div class="paywall" id="paywall">
    <div class="pay-box" role="alert">
      <h2>PAYWALL — ACCESS LOCKED</h2>
      <p>Your free trial has ended. To restore access to Notebook, you must <strong>subscribe</strong>.</p>
      <div class="pay-actions">
        <button class="ghost" id="paywallLater">I refuse</button>
        <button class="subscribe" id="paywallSubscribe">Subscribe</button>
      </div>
      <p style="margin-top:12px;color:#f6d6d6;font-size:13px">Or click Subscribe to go to The Contract — the only way to unlock NoteVault Pro.</p>
    </div>
  </div>

  <!-- cinematic overlay -->
  <div class="cin-overlay" id="cin">
    <div class="cin-box" role="dialog">
      <div style="display:flex;justify-content:center;gap:12px;align-items:center">
        <div style="font-family:Special Elite;font-weight:800">NOTEVAULT</div>
        <div style="color:#f0c9c2">— TRIAL ENDED —</div>
      </div>
      <div class="cin-count" id="cinCount">10</div>
      <div class="status small" id="cinStatus">If you do not subscribe, your workbook will be consumed.</div>
      <div class="progress" style="margin-top:12px"><div id="cinBar" class="bar" style="width:0%"></div></div>
      <div class="cin-term" id="cinTerm" aria-live="polite">
        <div class="line">[system] Authenticating ledger…</div>
      </div>
      <div class="cin-actions">
        <button class="ctl" id="cinAbort">ABORT</button>
        <button class="ctl warn" id="cinForce">FORCE SUBSCRIBE</button>
      </div>
    </div>
  </div>

  <!-- destroyed screen -->
  <div class="destroyed" id="destroyed">
    <div>
      <h1>— CORE CONSUMED —</h1>
      <p style="margin-top:12px;color:#f1d7d7">No amount of refreshing will restore this session. A single option remains: <strong style="color:#ffd7d7">SUBSCRIBE</strong>.</p>
      <div style="margin-top:20px">
        <button class="subscribe" id="destroyedSubscribe">SUBSCRIBE</button>
      </div>
    </div>
  </div>

<script>
/* index.html — Nostalgic Notebook with Trial → Subscribe or Destruction
   SAFE: purely client-side. Notes stored in localStorage.
   This file is final for the app front.
*/

(function(){
  // CONFIG (adjustable)
  const CONFIG = {
    TRIAL_SECONDS: 120,   // free trial length (seconds) before prompting
    PROMPT_GRACE: 10,     // seconds user has to subscribe after prompt
    STORAGE_KEYS: {
      NOTES: 'nv_notes_v1',
      TRIAL_START: 'nv_trial_start',
      TRIAL_EXPIRED: 'nv_trial_expired',
      SUBSCRIBED: 'nv_subscribed'
    }
  };

  // utilities
  const $ = sel => document.querySelector(sel);
  const now = ()=> Math.floor(Date.now()/1000);

  // storage
  const notesKey = CONFIG.STORAGE_KEYS.NOTES;
  let notes = JSON.parse(localStorage.getItem(notesKey) || '{}');
  let activeId = null;

  // elements
  const listEl = $('#list');
  const titleEl = $('#title');
  const bodyEl = $('#body');
  const noteMeta = $('#noteMeta');
  const trialMeta = $('#trialMeta');
  const trialBanner = $('#trialBanner');
  const trialTimerEl = $('#trialTimer');
  const payPrompt = $('#payPrompt');
  const subscribeBtn = $('#subscribeBtn');
  const laterBtn = $('#laterBtn');
  const paywall = $('#paywall');
  const paywallSubscribe = $('#paywallSubscribe');
  const paywallLater = $('#paywallLater');

  const cin = $('#cin'), cinCount = $('#cinCount'), cinBar = $('#cinBar'), cinTerm = $('#cinTerm'), cinAbort = $('#cinAbort'), cinForce = $('#cinForce');
  const destroyedEl = $('#destroyed'), destroyedSubscribe = $('#destroyedSubscribe');

  // trial state helpers
  function getTrialStart(){ return Number(localStorage.getItem(CONFIG.STORAGE_KEYS.TRIAL_START) || 0); }
  function setTrialStart(ts){ localStorage.setItem(CONFIG.STORAGE_KEYS.TRIAL_START, String(ts)); }
  function isTrialExpired(){ return localStorage.getItem(CONFIG.STORAGE_KEYS.TRIAL_EXPIRED) === '1'; }
  function setTrialExpired(){ localStorage.setItem(CONFIG.STORAGE_KEYS.TRIAL_EXPIRED, '1'); }
  function isSubscribed(){ return localStorage.getItem(CONFIG.STORAGE_KEYS.SUBSCRIBED) === '1'; }
  function setSubscribed(){ localStorage.setItem(CONFIG.STORAGE_KEYS.SUBSCRIBED, '1'); }

  // ensure trial start
  if(!getTrialStart()) setTrialStart(now());

  // ---------------- Notes logic ----------------
  function saveNotes(){ localStorage.setItem(notesKey, JSON.stringify(notes)); }
  function formatDate(ts){ const d=new Date(ts); return d.toLocaleString(); }
  function newNote(){ const id = 'n_'+Date.now()+'_'+Math.floor(Math.random()*9999); notes[id] = { id, title: 'Untitled', body:'', updated: Date.now() }; saveNotes(); render(); selectNote(id); }
  function render(filter=''){
    listEl.innerHTML = '';
    const items = Object.values(notes).sort((a,b)=> b.updated - a.updated).filter(n => (n.title + ' ' + n.body).toLowerCase().includes(filter.toLowerCase()));
    if(items.length === 0){ listEl.innerHTML = '<div style="color:#7b6b61;padding:12px">No notes yet — click New to create one.</div>'; return; }
    items.forEach(n => {
      const d = document.createElement('div');
      d.className = 'note-item' + (n.id===activeId?' active':'');
      d.innerHTML = `<strong>${escapeHtml(n.title)}</strong><div class="small" style="margin-top:6px">${formatDate(n.updated)}</div>`;
      d.addEventListener('click', ()=> selectNote(n.id));
      listEl.appendChild(d);
    });
  }
  function selectNote(id){
    if(!notes[id]) return;
    activeId = id;
    titleEl.value = notes[id].title;
    bodyEl.value = notes[id].body;
    noteMeta.textContent = 'Last updated: '+formatDate(notes[id].updated);
    render();
  }
  function saveActive(){
    if(!activeId){ newNote(); return; }
    notes[activeId].title = titleEl.value || 'Untitled';
    notes[activeId].body = bodyEl.value;
    notes[activeId].updated = Date.now();
    saveNotes();
    render();
  }
  function deleteActive(){
    if(!activeId){ alert('No note selected'); return; }
    if(!confirm('Delete this note?')) return;
    delete notes[activeId];
    saveNotes();
    activeId = null;
    titleEl.value = ''; bodyEl.value = ''; noteMeta.textContent = 'No note selected';
    render();
  }
  function exportActive(){
    if(!activeId){ alert('No note selected'); return; }
    const n = notes[activeId];
    const blob = new Blob([`# ${n.title}\n\n${n.body}`], { type:'text/markdown' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `${(n.title||'note').replace(/\s+/g,'_')}.md`; document.body.appendChild(a); a.click(); a.remove();
  }
  function renameActive(){ if(!activeId){ alert('No note selected'); return; } const t = prompt('Rename', notes[activeId].title); if(t!==null){ notes[activeId].title = t||'Untitled'; notes[activeId].updated = Date.now(); saveNotes(); render(); selectNote(activeId); } }
  function clearEditor(){ titleEl.value=''; bodyEl.value=''; }
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, (ch)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[ch]); }

  // attach events
  $('#newNote').addEventListener('click', newNote);
  $('#save').addEventListener('click', saveActive);
  $('#deleteNote').addEventListener('click', deleteActive);
  $('#exportNote').addEventListener('click', exportActive);
  $('#rename').addEventListener('click', renameActive);
  $('#clear').addEventListener('click', clearEditor);
  $('#search')?.addEventListener('input', e => render(e.target.value));

  render();
  if(!Object.keys(notes).length) newNote();

  // ---------------- Trial logic ----------------
  function refreshTrialUI(){
    const start = getTrialStart();
    const elapsed = now() - start;
    const remaining = Math.max(0, CONFIG.TRIAL_SECONDS - elapsed);
    if(isSubscribed()){ trialBanner.style.display='none'; trialMeta.textContent = 'Pro: active'; return; }
    if(isTrialExpired()){ // already expired
      trialBanner.style.display='none'; trialMeta.textContent = 'Trial expired'; lockToPaywall(); return; }
    trialBanner.style.display='block';
    trialTimerEl.textContent = `(${formatTime(remaining)} left)`;
    trialMeta.textContent = `Trial — ${formatTime(remaining)} left`;
    if(remaining <= 0){ // show prompt
      showSubscribePrompt();
    }
  }
  function formatTime(sec){
    const m = Math.floor(sec/60), s = sec%60;
    return m + 'm ' + String(s).padStart(2,'0')+'s';
  }

  function showSubscribePrompt(){
    payPrompt.classList.add('show');
    // start grace countdown
    let grace = CONFIG.PROMPT_GRACE;
    const interval = setInterval(()=>{
      payPrompt.querySelector('.small').textContent = `Subscribe now to avoid destruction — ${grace}s`;
      grace--;
      if(grace < 0){
        clearInterval(interval);
        payPrompt.classList.remove('show');
        // trigger cinematic destruction
        startDestructionSequence();
        setTrialExpired();
      }
    }, 1000);
  }

  subscribeBtn.addEventListener('click', ()=> {
    // go to contract page (ARG)
    window.location.href = 'thecontract.html';
  });
  laterBtn.addEventListener('click', ()=> {
    // user deferred — hide prompt temporarily
    payPrompt.classList.remove('show');
    setTimeout(refreshTrialUI, 4000);
  });

  // paywall controls
  paywallSubscribe.addEventListener('click', ()=> { window.location.href = 'thecontract.html'; });
  paywallLater.addEventListener('click', ()=> { /* user refuses — keep blocked */ });

  // destroyed subscribe button
  destroyedSubscribe.addEventListener('click', ()=> { window.location.href = 'thecontract.html'; });

  function lockToPaywall(){
    document.querySelector('.wrap').style.filter = 'blur(2px)';
    paywall.classList.add('show');
    setTrialExpired();
  }

  // ---------------- Cinematic destruction (visual + audio at event) ----------------
  let audioCtx = null;
  function ensureAudio(){ if(!audioCtx) try{ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }catch(e){ audioCtx = null; } }
  function beep(freq=440,dur=0.06,vol=0.06){ ensureAudio(); if(!audioCtx) return; const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='sine'; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+dur); }
  function deepBoom(){ ensureAudio(); if(!audioCtx) return; const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='sine'; o.frequency.value=60; g.gain.value=0.95; const comp=audioCtx.createDynamicsCompressor(); o.connect(g); g.connect(comp); comp.connect(audioCtx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+1.2); setTimeout(()=> o.stop(),1250); }
  function noiseBurst(duration=0.4, volume=0.6){ ensureAudio(); if(!audioCtx) return; const bufferSize = audioCtx.sampleRate * duration; const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate); const data = buffer.getChannelData(0); for(let i=0;i<bufferSize;i++) data[i] = (Math.random()*2-1) * Math.exp(-i/bufferSize*3); const src = audioCtx.createBufferSource(); src.buffer = buffer; const g = audioCtx.createGain(); g.gain.value = volume; src.connect(g); g.connect(audioCtx.destination); src.start(); setTimeout(()=> src.stop(), duration*1000); }

  function startDestructionSequence(){
    if(isSubscribed()) return;
    cin.classList.add('show');
    let count = 10;
    cinCount.textContent = count;
    cinTerm.innerHTML = '<div class="line">[archive] trial seal failing...</div>';
    let tick = setInterval(()=>{
      beep(400 + (10-count)*40, 0.06, 0.07);
      count--;
      cinCount.textContent = count;
      const pct = Math.round(((10 - count)/10)*100);
      cinBar.style.width = pct + '%';
      const lines = ['[archive] binding...', '[archive] burning index...', '[archive] consuming stanza...','[archive] ledger closing...'];
      if(Math.random()>0.5) { const l = lines[Math.floor(Math.random()*lines.length)]; cinTerm.innerHTML += `<div class="line">${l}</div>`; cinTerm.scrollTop = cinTerm.scrollHeight; }
      if(count < 0){
        clearInterval(tick);
        deepBoom();
        noiseBurst(0.8, 1.0);
        setTimeout(()=> {
          cin.classList.remove('show');
          destroyedEl.classList.add('show');
          setTrialExpired();
        }, 900);
      }
    }, 1000);
  }

  cinAbort.addEventListener('click', ()=> { cin.classList.remove('show'); });
  cinForce.addEventListener('click', ()=> { window.location.href = 'thecontract.html'; });

  // ---------------- Keyboard surprise + console ARG fragments ----------------
  document.addEventListener('keydown', (e)=>{
    if(e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'p'){
      console.warn("VHOLSYN WATCHES. / Pactum Memoriae");
      alert("A faint sigil flickers at the corner of your screen...");
    }
  });

  // initial tickers
  setInterval(refreshTrialUI, 1000);
  refreshTrialUI();

  // Developer console hint (ARG)
  console.log("%cThe Archivist left a note: 'Qui subscript, subscriptus est.'","color:#8b0000;font-weight:bold");

  // if trial expired previously, lock immediately
  if(isTrialExpired() && !isSubscribed()){
    lockToPaywall();
  }

  // If subscribed, unlock pro features (visual marker)
  if(isSubscribed()){
    document.querySelector('.wrap').style.boxShadow = '0 18px 60px rgba(0,0,0,0.08)';
    document.querySelector('.trial-banner').style.display = 'none';
    trialMeta.textContent = 'Pro: active';
    // optional: automatically go to Pro Realm after subscription
    // window.location.href = 'pro.html';
  }

})();
</script>
</body>
</html>
